config {
    type: "table",
    database: "housing-cicd",
    schema: "eudestgithub",
    name: "joined_data",
<<<<<<< HEAD
    tags: [
        "weekly", "hour", "github"
    ],
    assertions: {    
        nonNull : ["author_name", "description"]
    }

}



js { function sha_256(field) {
    return `
    SHA256(${field}) as ${field}
    `;
}
}


SELECT 
        sha
        author_date,
        ${sha_256("author_name")},
        committer_date,
        committer_name,
        message,
        repository_id,
        id,
        archived,
        created_at,
        default_branch,
        COALESCE(description, "NA") as description,        
        ${macro_convert_nulls_to_na.macro_convert_nulls_to_na("description")} as description_clean,
        fork,
        forks_count,
        full_name,
        homepage,
        language,
        name as unhashed_name,
        ${sha_256("name")},
        owner_id,
        private,
        watchers_count,
        branch_name
FROM ${ref("eudestgithub", "commits_clean")} as com
LEFT JOIN ${ref("eudestgithub", "repository")} as repo ON repo.id = com.repository_id
LEFT JOIN ${ref("eudestgithub", "branch_commit_relation")} as branch ON branch.commit_sha = com.sha
=======
}

SELECT sha,
        author_date,
        author_name,
        committer_date,
        committer_name,
        message,
        repository_id,
        id,
        archived,
        created_at,
        default_branch,
        description,
        fork,
        forks_count,
        full_name,
        homepage,
        language,
        name,
        owner_id,
        private,
        watchers_count,
        branch_name
FROM ${ref("eudestgithub","commit_clean")} as com
LEFT JOIN ${ref("eudestgithub","repository")} as repo ON repo.id = com.repository_id
LEFT JOIN ${ref("eudestgithub","branch_commit_relation")} as branch ON branch.commit_sha = com.sha
>>>>>>> refs/heads/master
